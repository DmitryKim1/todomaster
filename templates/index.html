<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TodoMaster</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div id="app" class="container">
        <h1>TodoMaster</h1>

        <section class="add-task">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</h2>
            <div class="form-row">
                <input
                    type="text"
                    id="taskInput"
                    v-model="newTitle"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"
                    @keypress.enter="addTask"
                />
                <button id="addBtn" @click="addTask">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </section>

        <section class="tasks">
            <h2>–ú–æ–∏ –∑–∞–¥–∞—á–∏</h2>
            <ul id="taskList">
                <li
                    v-for="task in tasks"
                    :key="task.id"
                    :class="{ done: task.done }"
                >
                    <span class="task-title" @click="toggleDone(task)">{{ task.title }}</span>
                    <span class="task-date">{{ task.created || '' }}</span>
                    <button class="btn-delete" @click="deleteTask(task.id)">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
                </li>
            </ul>
            <button id="clearAllBtn" class="btn-danger" @click="clearAll">üöÄ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏</button>
        </section>

        <footer>
            <a href="/stats">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a> |
            <a href="/health">üü¢ –°—Ç–∞—Ç—É—Å API</a> |
            <a href="/docs">üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API</a>
        </footer>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script>
    const { createApp } = Vue;
    const API_BASE = '';

    createApp({
        data() {
            return { tasks: [], newTitle: '' };
        },
        mounted() {
            this.loadTasks();
        },
        methods: {
            async loadTasks() {
                const res = await fetch(API_BASE + '/tasks');
                this.tasks = await res.json();
            },
            async addTask() {
                const title = this.newTitle.trim();
                if (!title) return;
                await fetch(API_BASE + '/tasks', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title }),
                });
                this.newTitle = '';
                await this.loadTasks();
            },
            async deleteTask(id) {
                await fetch(API_BASE + '/tasks/' + id, { method: 'DELETE' });
                await this.loadTasks();
            },
            async toggleDone(task) {
                await fetch(API_BASE + '/tasks/' + task.id, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ done: !task.done }),
                });
                await this.loadTasks();
            },
            async clearAll() {
                if (!confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏?')) return;
                await fetch(API_BASE + '/tasks/clear', { method: 'DELETE' });
                await this.loadTasks();
            },
        },
    }).mount('#app');
    </script>
</body>
</html>